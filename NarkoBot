import random
import asyncio
from telegram import InlineKeyboardButton, InlineKeyboardMarkup, Update
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

TELEGRAM_BOT_TOKEN = '8317064905:AAEMceq9WH3eMFUSBVd1CWI1L4eCb1SSml4' #–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

ITEM_PRICES = {
    "item_1": 2.0,
    "item_2": 1.7,
    "item_3": 4.0,
    "item_4": 3.2,#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    "item_5": 23.0,
    "item_6": 1.6,#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    "item_7": 2.2,
    "item_8": 20.0,
    "item_9": 20.0,
    "item_10": 20.0,
    "item_11": 68.0,
    "item_12": 37.0,
    "item_13": 50.0,
}

ITEM_NAMES = {
    "item_1": "S0–ª—å üßÇ",#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    "item_2": "–ú@—Äu–≤–∞–Ω@ üö¨",
    "item_3": "–ö0–∫–æS ü••",
    "item_4": "@–º—Ñ3—Ça–ºu–Ω üíé",
    "item_5": "@lpha PVP üíÄ",
    "item_6": "3–∫s—Ç–∞–∑u üéâ",#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    "item_7": "–úy–∫@ üåæ",
    "item_8": "–ì–∞wuw üçÅ",
    "item_9": "Wu—à–∫–∏ üåø",
    "item_10": "S–ø@–πs üåà",
    "item_11": "MDM@ üíä",
    "item_12": "LSD üåå",#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    "item_13": "MIX üçπ",
}

current_item = None
previous_message = {"text": "", "markup": None}#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

def create_button(text, callback_data):
    return InlineKeyboardButton(text=text, callback_data=callback_data)

def create_menu():
    report_button = create_button("üìã –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤", "report")#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    profile_button = create_button("üìã –ü—Ä–æ—Ñ–∏–ª—å", "profile")
    payment_button = create_button("üí≥ –ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å", "payment_info")
    menu = InlineKeyboardMarkup([[report_button, profile_button], [payment_button]])
    return menu#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await update.message.reply_text("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –º–µ–Ω—é:", reply_markup=create_menu())

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    global current_item
    query = update.callback_query#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    await query.answer()

    if query.data == "report":
        text = "–í—ã–±–µ—Ä–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π —Ç–æ–≤–∞—Ä:"
        markup = create_item_menu()
        await safe_edit_message_text(query, text, markup)#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    elif query.data.startswith("item_"):
        current_item = query.data#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        text = f"–í—ã –≤—ã–±—Ä–∞–ª–∏ —Ç–æ–≤–∞—Ä {ITEM_NAMES[current_item]}.\nüíé –í–≤–µ–¥–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ –≥—Ä–∞–º–º–æ–≤ –≤—ã –∂–µ–ª–∞–µ—Ç–µ:"
        markup = create_back_button_menu()
        await safe_edit_message_text(query, text, markup)#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        return
    elif query.data == "profile":#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        text = "–í—ã –æ—Ç–∫—Ä—ã–ª–∏ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å.\n\nüé≠ –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–Ω–æ–Ω–∏–º–Ω—ã!\n"
        await safe_edit_message_text(query, text)
    elif query.data == "payment_info":
        text = ("üí≥ –ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å:\n\n"
                "1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ @CryptoBot.\n"
                "2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.\n"#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
                "3. –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é P2P.\n"
                "4. –í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –ö—É–ø–∏—Ç—å\n"
                "5. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã\n"
                "6. –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ\n"
                "7. –û–∂–∏–¥–∞–π—Ç–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ \n"#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
                "8. –ü–µ—Ä–µ–≤–æ–¥–∏—Ç–µ –ø–æ —Å—á–µ—Ç—É –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–ª–∞–¥–µ–ª–µ—Ü!\n"
                "9. –ì–æ—Ç–æ–≤–æ!")
        await safe_edit_message_text(query, text)
    elif query.data == "back":
        text = "–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤:\n"
        markup = create_item_menu()
        await safe_edit_message_text(query, text, markup)
#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
def create_item_menu():
    item_buttons = [
        [create_button("üßÇ S0–ª—å", "item_1"), create_button("üö¨ –ú@—Äu–≤–∞–Ω–∞", "item_2")],
        [create_button("ü•• –ö–æ–∫0s", "item_3"), create_button("üíé @–º—Ñ3—Ç@–º–∏–Ω", "item_4")],
        [create_button("üíÄ @lph@ PVP", "item_5"), create_button("üéâ 3–∫s—Ç@–∑–∏", "item_6")],#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        [create_button("üåæ –ú—É–∫–∞", "item_7"), create_button("üçÅ –ì–∞w–∏—à", "item_8")],
        [create_button("üåø –®u—à–∫–∏", "item_9"), create_button("üåà –°–ø@–πs", "item_10")],
        [create_button("üíä MDM@", "item_11"), create_button("üåå LSD", "item_12")],
        [create_button("üçπ MIX", "item_13")],
        [create_button("‚û°Ô∏è –ù–∞–∑–∞–¥", "back")]#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    ]
    return InlineKeyboardMarkup(item_buttons)

def create_back_button_menu():
    back_button = create_button("‚û°Ô∏è –ù–∞–∑–∞–¥", "back")
    return InlineKeyboardMarkup([[back_button]])#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

async def receive_grams(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    global current_item
    if current_item is None:
        await update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä.")#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        return

    try:
        grams = float(update.message.text)
        price_per_gram = ITEM_PRICES[current_item]
        total_cost = grams * price_per_gram
        item_name = ITEM_NAMES[current_item]

        payment_button = InlineKeyboardButton("üí≥ –û–ø–ª–∞—Ç–∏—Ç—å", url="http://t.me/send?start=IVUtfDDFffTh") # –ø–æ–º–µ–Ω—è–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à—É
        markup = InlineKeyboardMarkup([[payment_button]])

        await update.message.reply_text(
            f"–°—Ç–æ–∏–º–æ—Å—Ç—å {grams:.1f} –≥—Ä–∞–º–º(–∞) —Ç–æ–≤–∞—Ä–∞ {item_name} —Å–æ—Å—Ç–∞–≤–∏—Ç ${total_cost:.2f}.\n"
            "–í–∞–∂–Ω–æ! –û–ø–ª–∞—Ç–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ –≤–∞–º –ø–æ–∫–∞–∑–∞–ª –±–æ—Ç!",
            reply_markup=markup)#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

        await asyncio.sleep(30)
        await update.message.reply_text("‚è∞ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã!")
#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        await asyncio.sleep(29)
        return_markup = create_menu_with_back()
        await update.message.reply_text("‚ùå –ú—ã –Ω–µ –Ω–∞—à–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏!", reply_markup=return_markup)

        current_item = None
    except ValueError:
        await update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ (–≤ –≥—Ä–∞–º–º–∞—Ö).")

def create_menu_with_back():#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    back_button = InlineKeyboardButton("‚û°Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é", callback_data="back")
    return InlineKeyboardMarkup([[back_button]])#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

async def safe_edit_message_text(query, text, markup=None):
    global previous_message#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    if text != previous_message["text"] or markup != previous_message["markup"]:
        await query.edit_message_text(text=text, reply_markup=markup)
        previous_message["text"] = text#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
        previous_message["markup"] = markup
    else:
        await query.answer("–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å, —Ç–∞–∫ –∫–∞–∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.")

def main():
    global current_item
    current_item = None#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

    application = ApplicationBuilder().token(TELEGRAM_BOT_TOKEN).build()
#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
    application.add_handler(CommandHandler('start', start))
    application.add_handler(CallbackQueryHandler(button_handler))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, receive_grams))#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

    application.run_polling()#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx

if __name__ == '__main__':
    main()#–ö–û–î –°–î–ï–õ–ê–õ @Fell1ksx
